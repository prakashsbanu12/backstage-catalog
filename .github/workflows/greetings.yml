name: Backstage Greetings & Validation

on:
  pull_request_target:
    types: [opened]
  issues:
    types: [opened]

jobs:
  greet-and-validate:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      pull-requests: write
      contents: read

    steps:
      # ğŸ‘‹ First-time contributor greeting
      - name: Greet first-time contributor
        uses: actions/first-interaction@v1
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          issue-message: "ğŸ‘‹ Welcome! Thanks for opening your first issue in our Backstage repo. We'll review it shortly."
          pr-message: "ğŸ‰ Thanks for your first PR! If it includes a catalog entity, make sure your `catalog-info.yaml` is valid."

      # âœ… Validate catalog-info.yaml if present
      - name: Check for catalog-info.yaml
        run: |
          if [ -f "catalog-info.yaml" ]; then
            echo "Found catalog-info.yaml"
            # You can add validation logic here, e.g. using backstage-cli
          else
            echo "No catalog-info.yaml found"
          fi

      # ğŸ·ï¸ Optional: Add label to Backstage-related PRs
      - name: Label Backstage PR
        if: github.event_name == 'pull_request_target'
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            github.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              labels: ['backstage']
            })
