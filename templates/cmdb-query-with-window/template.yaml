apiVersion: scaffolder.backstage.io/v1beta3
kind: Template
metadata:
  name: cmdb-host-registration
  title: Register Host via CMDB
  description: Queries CMDB and generates catalog-info.yaml via GitHub workflow
spec:
  owner: banu
  type: service
  parameters:
    - title: Host Input
      required:
        - host_name
      properties:
        host_name:
          type: string
          title: Host Name
          description: Enter the hostname to query CMDB
          ui:widget: text
  steps:
    - id: trigger-cmdb-workflow
      name: Trigger GitHub Workflow
      action: github:actions:dispatch
      input:
        repoUrl: github.com?repo=cmdb-host-registration&owner=banu
        workflowId: cmdb-register.yaml
        branchOrTagName: main  # âœ… Required field added
        workflowInputs:
          host_name: ${{ parameters.host_name }}
        token: ${{ secrets.GITHUB_TOKEN }}  # Assumes a token is available via Backstage secrets
    - id: verify
      name: Verify Workflow Completion
      action: debug:log
      input:
        message: "Workflow triggered for host ${{ parameters.host_name }}. Check GitHub repository for catalog-info.yaml."
